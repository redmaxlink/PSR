<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
      .b {border: 1px solid red;}
    </style>
  </head>
  <body>


    <div class="" style="display: none;">
      <input type="datetime-local" id="departureActual" value="2022-09-08T16:17:00.000">
      <input type="datetime-local" id="destinationActual" value="2022-09-09T05:48:00.000">
    </div>

    </br></br></br></br>
    </br></br></br></br>
    </br></br></br></br>
    </br></br></br></br>

    <div class="" id="light" style="margin-left: -50px; position:absolute;" onclick="lightchange()">
      <img class="" style="object-fit:fill; height:100px;" src="moon.png">
      <output class="" style="display:block; text-align: center;">HI</output>
    </div>

    </br></br></br></br>
    </br></br></br></br>

    <div class="" id="line1" style="position:absolute;">
      <output class="" style="display: block; margin-left:-50px; text-align: center;"></output>
      <svg class = "" width="4" height="187">
        <rect class = "line" width="8" height="187" style="fill:grey;" />
      </svg>
    </div>

    <div class="" id="line2" style="position:absolute;">
      <output class="" style="display: block; text-align: center;"></output>
      <svg class = "" width="4" height="187">
        <rect class = "line" width="8" height="187" style="fill:grey;" />
      </svg>
    </div>



    </br></br></br></br>
    </br></br></br></br>


    <div class="" id="base" style="position: absolute; left: 20%; width: 60%; height: 50px; border-radius: 25px; border: 2px solid grey;"></div>

    <script type="text/javascript">

      //////////////////////////////////////////////////////////////////////////

      const start = document.getElementById('departureActual').valueAsNumber;
      const end = document.getElementById('destinationActual').valueAsNumber;
      const l1 = document.getElementById('line1');
      const light = document.getElementById('light');
      const l2 = document.getElementById('line2');

      //////////////////////////////////////////////////////////////////////////

      var c = 60 / ((end - start)/60000);

      ////

      l1.style.left = 20 + 60 * 0.33 + '%';
      l1.firstElementChild.value = get_utc( start + 60000 * (60 * 0.33) / c );
      l1.addEventListener('touchmove', function(event) {

        var touch = event.targetTouches[0].pageX / window.innerWidth * 100;

        ////

        if(touch <= 20){drag = 20}
        else if( touch >= 80){drag = 80}
        else{drag = touch};

        ////

        l1.style.left = drag + '%';
        this.firstElementChild.value = get_utc( start + 60000 * (drag - 20)/c );

        ////

        let diff = value(l2.style.left) - drag;
        light.lastElementChild.value =  get_hhmm( (diff / c).toFixed(0) * 60000 );
        light.style.left = drag + diff / 2 + '%';

        ////
        
        event.preventDefault();

      }, false);

      ////////////////

      l2.style.left = 20 + 60 * 0.66 + '%';
      l2.firstElementChild.value = get_utc( start + 60000 * (60 * 0.66)/c );
      l2.addEventListener('touchmove', function(event) {

        var touch = event.targetTouches[0].pageX / window.innerWidth * 100;

        ////

        let min = value(l1.style.left) + c * 10;
        if(touch <= min){drag = min;}
        else if(touch >= 80){drag = 80}
        else{drag = touch};

        ////

        l2.style.left = drag + '%';
        this.firstElementChild.value = get_utc( start + 60000 * (drag - 20)/c );

        ////

        let diff = drag - value(l1.style.left);
        light.lastElementChild.value =  get_hhmm( (diff / c).toFixed(0) * 60000 );
        light.style.left = value(l1.style.left) + diff / 2 + '%';

        ////

        event.preventDefault();

      }, false);

      ////////////////

      light.style.left = 50 + '%';
      let r = value(l2.style.left) - value(l1.style.left);
      light.lastElementChild.value =  get_hhmm( (r / c).toFixed(0) * 60000 );

      //////////////////////////////////////////////////////////////////////////

      function value(data){
        return Number(data.slice(0, data.length - 1));
      };
      function lightchange(){

        if(light.firstElementChild.src.endsWith("sun.png")){
          light.firstElementChild.src = "moon.png";
          outer = 'yellow'
          inner = 'grey';
        }
        else{
          light.firstElementChild.src = "sun.png";
          outer = 'grey'
          inner = 'yellow';
        }
        l1.lastElementChild.firstElementChild.style.fill = inner;
        l2.lastElementChild.firstElementChild.style.fill = inner;
        base_color();
      };

      function get_utc(time){
        time = new Date(time);
        hh = time.getUTCHours();
        hh = ('0'+ hh).slice(-2);
        mm = time.getUTCMinutes();
        mm = ('0'+ mm).slice(-2);
        return hh + ':' + mm;
      };
      function get_hhmm(block){

        block = block / 60000;
        hh = Math.trunc(block / 60);
        hh = ('0'+ hh).slice(-2);
        mm = block % 60;
        mm = ('0'+ mm).slice(-2);
        return hh + ':' + mm;

      };

      //////////////////////////////////////////////////////////////////////////

    </script>


  </body>
</html>
