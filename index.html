<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
      .b {border: 1px solid red;}
    </style>
  </head>
  <body>


    <div class="" style="display: none;">
      <input type="datetime-local" id="departureActual" value="2022-09-08T16:17:00.000">
      <input type="datetime-local" id="destinationActual" value="2022-09-09T05:48:00.000">
    </div>

    </br></br></br></br>
    </br></br></br></br>
    </br></br></br></br>
    </br></br></br></br>

    <div class="" id="light" style="position:absolute;" onclick="lightchange()">
      <img class="" style="object-fit:fill; height:50px;" src="moon.png">
      <output class="" style="display:block; text-align: center;">HI</output>
    </div>

    </br></br></br></br>

    <div class="" id="line1" style="position:absolute;">
      <output class="" style="display: block; margin-left:-50px; text-align: center;"></output>
      <svg class = "" width="4" height="300">
        <rect class = "" width="8" height="300" style="fill:grey;" />
      </svg>
    </div>

    <div class="" id="line2" style="position:absolute;">
      <output class="" style="display: block; text-align: center;"></output>
      <svg class = "" width="4" height="300">
        <rect class = "" width="8" height="300" style="fill:grey;" />
      </svg>
    </div>



    </br></br></br></br>
    </br></br></br></br>


    <div class="" style="position: absolute; left: 20%; width: 60%; height: 50px; border-radius: 25px; border: 2px solid grey;"></div>

    <script type="text/javascript">

      //////////////////////////////////////////////////////////////////////////

      let width_start = window.innerWidth * 0.20;
      let width_end = window.innerWidth * 0.80;
      let start = document.getElementById('departureActual').valueAsNumber;
      let end = document.getElementById('destinationActual').valueAsNumber;
      let a = width_end - width_start;
      let b = (end - start)/60000;
      let c = (a / b);

      //////////////////////////////////////////////////////////////////////////

      var l1 = document.getElementById('line1');
      var light = document.getElementById('light');
      var l2 = document.getElementById('line2');


      let l1_pos = width_start + a * 0.33;
      l1.style.left = l1_pos + 'px';
      l1.firstElementChild.value = get_utc( start + 60000 * (l1_pos - width_start)/c );
      l1.addEventListener('touchmove', function(event) {
        var touch = event.targetTouches[0];

        let drag = width_start;
        if(touch.pageX <= width_start){drag = width_start;}
        else if(touch.pageX >= width_end){drag = width_end;}
        else{drag = touch.pageX;};

        l1.style.left = drag + 'px';

        let diff = value(l2.style.left) - drag;
        light.lastElementChild.value =  get_hhmm( diff * 60000 / c );
        light.style.left = drag + diff / 2 - 25 + 'px';

        drag = get_utc( start + 60000 * (drag - width_start)/c );
        this.firstElementChild.value = drag;

        event.preventDefault();

      }, false);


      let l2_pos = width_start + a * 0.66;
      l2.style.left = l2_pos + 'px';
      l2.firstElementChild.value = get_utc( start + 60000 * (l2_pos - width_start)/c );
      l2.addEventListener('touchmove', function(event) {
        var touch = event.targetTouches[0];

        let min = value(l1.style.left) + c * 10;
        //let drag = width_start;
        if(touch.pageX <= min){drag = min;}
        else if(touch.pageX >= width_end){drag = width_end;}
        else{drag = touch.pageX;};

        l2.style.left = drag + 'px';

        let diff = drag - value(l1.style.left);
        // let light_time = ((drag - value(l1.style.left)) / c).toFixed(0);
        // light.lastElementChild.value =  get_hhmm( light_time * 60000 );
        light.style.left = value(l1.style.left) + diff / 2 - 25 + 'px';

        drag = get_utc( start + 60000 * (drag - width_start)/c );
        this.firstElementChild.value = drag;

        event.preventDefault();

      }, false);


      let light_pos = (l2_pos - l1_pos) / 2;
      light.style.left = l1_pos + light_pos - 25 + 'px';

      //////////////////////////////////////////////////////////////////////////
      function value(data){
        return Number(data.slice(0, data.length - 2));
      };

      function get_utc(time){
        time = new Date(time);
        hh = time.getUTCHours();
        hh = ('0'+ hh).slice(-2);
        mm = time.getUTCMinutes();
        mm = ('0'+ mm).slice(-2);
        return hh + ':' + mm;
      };
      function get_hhmm(block){
        //block = (b - a)/60000;
        block = block / 60000;
        hh = Math.trunc(block / 60);
        hh = ('0'+ hh).slice(-2);
        mm = block % 60;
        mm = ('0'+ mm).slice(-2);
        return hh + ':' + mm;
      };

      function lightchange(){
        console.log(light);
      };
      //////////////////////////////////////////////////////////////////////////

    </script>


  </body>
</html>
